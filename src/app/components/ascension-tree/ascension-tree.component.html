<div class="ascension-tree-container">
  <div class="ascension-header">
    <h2>★ Stellar Nexus</h2>
    <div class="points-display">
      <span class="points-current">{{ points() }}</span>
      <span class="points-label">Stellar Cores</span>
      <span class="points-total">({{ totalPoints() }} total earned)</span>
    </div>
  </div>
  <div class="ascension-info">
    <p>Complete Tier 5 to earn Stellar Cores. Spend them on permanent upgrades that enhance your progression!</p>
    @if (totalPoints() > 0) {
      <p class="global-bonus">✦ Global Production Multiplier: <strong>{{ globalMultiplier() }}x</strong></p>
    }
  </div>
  <div class="tree-visualization">
    <div class="nodes-container">
      <div class="tier-section">
        <div class="tier-header">★ Core Automation</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 0) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ✓ }
                  @else if (canPurchase(node.id)) { ★ }
                  @else { ⊗ }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} SC</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
      <div class="tier-section">
        <div class="tier-header">✦ Primary Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 1) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ✓ }
                  @else if (canPurchase(node.id)) { ★ }
                  @else { ⊗ }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} SC</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
      <div class="tier-section">
        <div class="tier-header">✧ Secondary Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 2) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ✓ }
                  @else if (canPurchase(node.id)) { ★ }
                  @else { ⊗ }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} SC</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
      <div class="tier-section">
        <div class="tier-header">⚡ Automation</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 3) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ✓ }
                  @else if (canPurchase(node.id)) { ★ }
                  @else { ⊗ }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} SC</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
      <div class="tier-section">
        <div class="tier-header">✵ Tertiary Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 4) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ✓ }
                  @else if (canPurchase(node.id)) { ★ }
                  @else { ⊗ }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} SC</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
      <div class="tier-section">
        <div class="tier-header">◈ Advanced Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 5) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ✓ }
                  @else if (canPurchase(node.id)) { ★ }
                  @else { ⊗ }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} SC</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
      <div class="tier-section">
        <div class="tier-header">◆ Convergence Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 6) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ✓ }
                  @else if (canPurchase(node.id)) { ★ }
                  @else { ⊗ }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} SC</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
      <div class="tier-section">
        <div class="tier-header">◉ Ultimate Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 7) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ✓ }
                  @else if (canPurchase(node.id)) { ★ }
                  @else { ⊗ }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} SC</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
      <div class="tier-section">
        <div class="tier-header">✦ Final Mastery</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 8) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ✓ }
                  @else if (canPurchase(node.id)) { ★ }
                  @else { ⊗ }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} SC</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
    </div>
  </div>
  <div class="legend">
    <div class="legend-item">
      <span class="legend-icon node-purchased">✓</span>
      <span>Purchased</span>
    </div>
    <div class="legend-item">
      <span class="legend-icon node-available">★</span>
      <span>Available</span>
    </div>
    <div class="legend-item">
      <span class="legend-icon node-locked">⊗</span>
      <span>Locked</span>
    </div>
  </div>
</div>