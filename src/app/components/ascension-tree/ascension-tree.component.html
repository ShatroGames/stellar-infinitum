<div class="ascension-tree-container">
  <div class="ascension-header">
    <h2>‚≠ê Cosmic Nexus</h2>
    <div class="points-display">
      <span class="points-current">{{ points() }}</span>
      <span class="points-label">Ascension Points</span>
      <span class="points-total">({{ totalPoints() }} total earned)</span>
    </div>
  </div>

  <div class="ascension-info">
    <p>Complete Tier 5 to earn Ascension Points. Spend them on permanent upgrades that enhance your progression!</p>
  </div>

  <div class="tree-visualization">
    <div class="nodes-container">
      <!-- Tier 1: Starting Node -->
      <div class="tier-section">
        <div class="tier-header">‚≠ê Core Automation</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 0) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ‚úì }
                  @else if (canPurchase(node.id)) { ‚≠ê }
                  @else { üîí }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} AP</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- Tier 2: Three Branches -->
      <div class="tier-section">
        <div class="tier-header">üåü Primary Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 1) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ‚úì }
                  @else if (canPurchase(node.id)) { ‚≠ê }
                  @else { üîí }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} AP</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- Tier 3: Secondary Upgrades -->
      <div class="tier-section">
        <div class="tier-header">‚ú® Secondary Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 2) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ‚úì }
                  @else if (canPurchase(node.id)) { ‚≠ê }
                  @else { üîí }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} AP</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- Tier 4: Tertiary Upgrades -->
      <div class="tier-section">
        <div class="tier-header">üí´ Tertiary Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 3) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ‚úì }
                  @else if (canPurchase(node.id)) { ‚≠ê }
                  @else { üîí }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} AP</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- Tier 5: Advanced Upgrades -->
      <div class="tier-section">
        <div class="tier-header">üå† Advanced Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 4) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ‚úì }
                  @else if (canPurchase(node.id)) { ‚≠ê }
                  @else { üîí }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} AP</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- Tier 6: Convergence -->
      <div class="tier-section">
        <div class="tier-header">üíé Convergence Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 5) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ‚úì }
                  @else if (canPurchase(node.id)) { ‚≠ê }
                  @else { üîí }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} AP</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>

      <!-- Tier 7: Ultimate -->
      <div class="tier-section">
        <div class="tier-header">üëë Ultimate Upgrades</div>
        <div class="tier-nodes">
          @for (node of Array.from(nodes().values()); track node.id) {
            @if (node.position.y === 6 || node.position.y === 7) {
              <div class="ascension-node {{ getNodeClass(node) }}" [attr.data-node-id]="node.id">
                <div class="node-icon">
                  @if (node.purchased) { ‚úì }
                  @else if (canPurchase(node.id)) { ‚≠ê }
                  @else { üîí }
                </div>
                <div class="node-info">
                  <h4 class="node-name">{{ node.name }}</h4>
                  <p class="node-effect">{{ getEffectDescription(node) }}</p>
                  <div class="node-cost">Cost: {{ node.cost }} AP</div>
                </div>
                @if (!node.purchased && canPurchase(node.id)) {
                  <button class="btn-purchase" (click)="onPurchase(node.id)" [disabled]="!canPurchase(node.id)">
                    Purchase
                  </button>
                }
              </div>
            }
          }
        </div>
      </div>
    </div>
  </div>

  <div class="legend">
    <div class="legend-item">
      <span class="legend-icon node-purchased">‚úì</span>
      <span>Purchased</span>
    </div>
    <div class="legend-item">
      <span class="legend-icon node-available">‚≠ê</span>
      <span>Available</span>
    </div>
    <div class="legend-item">
      <span class="legend-icon node-locked">üîí</span>
      <span>Locked</span>
    </div>
  </div>
</div>
